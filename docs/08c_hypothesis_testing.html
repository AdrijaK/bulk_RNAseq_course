
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="img/sandbox1.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.14">
    
    
      
        <title>Hypothesis testing - Bulk RNAseq data analysis</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.3de6f41f.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.cc9b2e1e.min.css">
        
          
          
          <meta name="theme-color" content="#757575">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="extra.css">
    
    <script>__md_scope=new URL(".",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="grey" data-md-color-accent="cyan">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#learning-objectives" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="https://hds-sandbox.github.io/" title="Bulk RNAseq data analysis" class="md-header__button md-logo" aria-label="Bulk RNAseq data analysis" data-md-component="logo">
      
  <img src="img/sandbox1.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Bulk RNAseq data analysis
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Hypothesis testing
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://hds-sandbox.github.io/" title="Bulk RNAseq data analysis" class="md-nav__button md-logo" aria-label="Bulk RNAseq data analysis" data-md-component="logo">
      
  <img src="img/sandbox1.png" alt="logo">

    </a>
    Bulk RNAseq data analysis
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        Course Introduction
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="02_setup.html" class="md-nav__link">
        Setup
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="03_experimental_planning.html" class="md-nav__link">
        Experimental planning
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="04_data_explanation.html" class="md-nav__link">
        Data Explanation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="05_preprocessing.html" class="md-nav__link">
        Preprocessing
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          RNAseq counts
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="RNAseq counts" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          RNAseq counts
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="06a_count_matrix.html" class="md-nav__link">
        Count matrix
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="06b_count_normalization.html" class="md-nav__link">
        Normalization
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="07_exploratory_analysis.html" class="md-nav__link">
        Exploratory Analysis
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_8">
          Differential Expression
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Differential Expression" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Differential Expression
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="08a_contrast_design.html" class="md-nav__link">
        Design formula
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="08b_DEA.html" class="md-nav__link">
        DESeq2
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Hypothesis testing
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="08c_hypothesis_testing.html" class="md-nav__link md-nav__link--active">
        Hypothesis testing
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#learning-objectives" class="md-nav__link">
    Learning Objectives
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deseq2-model-fitting-and-hypothesis-testing" class="md-nav__link">
    DESeq2: Model fitting and Hypothesis testing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#generalized-linear-model" class="md-nav__link">
    Generalized Linear Model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hypothesis-testing" class="md-nav__link">
    Hypothesis testing
  </a>
  
    <nav class="md-nav" aria-label="Hypothesis testing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#wald-test" class="md-nav__link">
    Wald test
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#likelihood-ratio-test-lrt" class="md-nav__link">
    Likelihood ratio test (LRT)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multiple-test-correction" class="md-nav__link">
    Multiple test correction
  </a>
  
    <nav class="md-nav" aria-label="Multiple test correction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-does-the-p-value-mean" class="md-nav__link">
    What does the p-value mean?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#correcting-the-p-value-for-multiple-testing" class="md-nav__link">
    Correcting the p-value for multiple testing
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exploring-results-wald-test" class="md-nav__link">
    Exploring Results (Wald test)
  </a>
  
    <nav class="md-nav" aria-label="Exploring Results (Wald test)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#specifying-contrasts" class="md-nav__link">
    Specifying contrasts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#does-it-matter-what-i-choose-to-be-my-base-level" class="md-nav__link">
    Does it matter what I choose to be my base level?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-results-table" class="md-nav__link">
    The results table
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#p-values" class="md-nav__link">
    P-values
  </a>
  
    <nav class="md-nav" aria-label="P-values">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gene-level-filtering" class="md-nav__link">
    Gene-level filtering
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fold-changes" class="md-nav__link">
    Fold changes
  </a>
  
    <nav class="md-nav" aria-label="Fold changes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#an-alternative-approach-to-add-the-fold-change-threshold" class="md-nav__link">
    An alternative approach to add the fold change threshold:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summarizing-results" class="md-nav__link">
    Summarizing results
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extracting-significant-differentially-expressed-genes" class="md-nav__link">
    Extracting significant differentially expressed genes
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="08d_DEA_visualization.html" class="md-nav__link">
        Visualization
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9" type="checkbox" id="__nav_9" >
      
      
      
      
        <label class="md-nav__link" for="__nav_9">
          Functional Analysis
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Functional Analysis" data-md-level="1">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          Functional Analysis
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="09a_FA_genomic_annotation.html" class="md-nav__link">
        Gene annotation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="09b_FA_overrepresentation.html" class="md-nav__link">
        Over represetation analysis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="09c_FA_GSEA.html" class="md-nav__link">
        Class scoring
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="10_summarized_workflow.html" class="md-nav__link">
        Summarized workflow
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#learning-objectives" class="md-nav__link">
    Learning Objectives
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deseq2-model-fitting-and-hypothesis-testing" class="md-nav__link">
    DESeq2: Model fitting and Hypothesis testing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#generalized-linear-model" class="md-nav__link">
    Generalized Linear Model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hypothesis-testing" class="md-nav__link">
    Hypothesis testing
  </a>
  
    <nav class="md-nav" aria-label="Hypothesis testing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#wald-test" class="md-nav__link">
    Wald test
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#likelihood-ratio-test-lrt" class="md-nav__link">
    Likelihood ratio test (LRT)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multiple-test-correction" class="md-nav__link">
    Multiple test correction
  </a>
  
    <nav class="md-nav" aria-label="Multiple test correction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-does-the-p-value-mean" class="md-nav__link">
    What does the p-value mean?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#correcting-the-p-value-for-multiple-testing" class="md-nav__link">
    Correcting the p-value for multiple testing
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exploring-results-wald-test" class="md-nav__link">
    Exploring Results (Wald test)
  </a>
  
    <nav class="md-nav" aria-label="Exploring Results (Wald test)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#specifying-contrasts" class="md-nav__link">
    Specifying contrasts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#does-it-matter-what-i-choose-to-be-my-base-level" class="md-nav__link">
    Does it matter what I choose to be my base level?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-results-table" class="md-nav__link">
    The results table
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#p-values" class="md-nav__link">
    P-values
  </a>
  
    <nav class="md-nav" aria-label="P-values">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gene-level-filtering" class="md-nav__link">
    Gene-level filtering
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fold-changes" class="md-nav__link">
    Fold changes
  </a>
  
    <nav class="md-nav" aria-label="Fold changes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#an-alternative-approach-to-add-the-fold-change-threshold" class="md-nav__link">
    An alternative approach to add the fold change threshold:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summarizing-results" class="md-nav__link">
    Summarizing results
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extracting-significant-differentially-expressed-genes" class="md-nav__link">
    Extracting significant differentially expressed genes
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


  <h1>Hypothesis testing</h1>

<p>Approximate time: 90 minutes</p>
<h2 id="learning-objectives">Learning Objectives</h2>
<ul>
<li>Describe the process of model fitting</li>
<li>Compare two methods for hypothesis testing (Wald test vs. LRT)</li>
<li>Discuss the steps required to generate a results table for pairwise
    comparisons (Wald test)</li>
<li>Recognize the importance of multiple test correction</li>
<li>Identify different methods for multiple test correction</li>
<li>Summarize the different levels of gene filtering</li>
<li>Evaluate the number of differentially expressed genes produced for
    each comparison</li>
<li>Construct R objects containing significant genes from each
    comparison</li>
</ul>
<h2 id="deseq2-model-fitting-and-hypothesis-testing">DESeq2: Model fitting and Hypothesis testing</h2>
<p>The final step in the DESeq2 workflow is taking the counts for each gene
and fitting it to the model and testing for differential expression.</p>
<p><img src="./img/08c_hypothesis_testing/de_workflow.png" style="display: block; margin: auto;" /></p>
<h2 id="generalized-linear-model">Generalized Linear Model</h2>
<p>As described <a href="06a_count_matrix.html">earlier</a>, the count data generated by
RNA-seq exhibits overdispersion (variance > mean) and the statistical
distribution used to model the counts needs to account for this. As
such, DESeq2 uses a <strong>negative binomial distribution to model the
RNA-seq counts using the equation below</strong>:</p>
<p><img src="./img/08c_hypothesis_testing/NB_model_formula.png" style="display: block; margin: auto;" /></p>
<p>The two parameters required are the <strong>size factor, and the dispersion
estimate</strong>. Next, a generalized linear model (GLM) of the NB family is
used to fit the data. Modeling is a mathematically formalized way to
approximate how the data behaves given a set of parameters.</p>
<blockquote>
<p>“<em>In statistics, the generalized linear model (GLM) is a flexible
generalization of ordinary linear regression that allows for response
variables that have error distribution models other than a normal
distribution. The GLM generalizes linear regression by allowing the
linear model to be related to the response variable via a link
function and by allowing the magnitude of the variance of each
measurement to be a function of its predicted value.”
(<a href="https://en.wikipedia.org/wiki/Generalized_linear_model">Wikipedia</a>)</em>.</p>
</blockquote>
<p>After the model is fit, coefficients are estimated for each sample group
along with their standard error. The coefficents are the estimates for
the <strong>log2 fold changes</strong>, and will be used as input for hypothesis
testing.</p>
<h2 id="hypothesis-testing">Hypothesis testing</h2>
<p>The first step in hypothesis testing is to set up a <strong>null hypothesis</strong>
for each gene. In our case, the null hypothesis is that there is <strong>no
differential expression across the two sample groups (LFC == 0)</strong>.
Notice that we can do this without observing any data, because it is
based on a thought experiment. Second, we use a statistical test to
determine if based on the observed data, the null hypothesis is true.</p>
<h3 id="wald-test">Wald test</h3>
<p>In DESeq2, the <strong>Wald test is the default used for hypothesis testing
when comparing two groups</strong>. The Wald test is a test usually performed
on parameters that have been estimated by maximum likelihood. In our
case we are testing each gene model coefficient (LFC) which was derived
using parameters like dispersion, which were estimated using maximum
likelihood.</p>
<p>DESeq2 implements the Wald test by: * Taking the LFC and dividing it by
its standard error, resulting in a z-statistic * The z-statistic is
compared to a standard normal distribution, and a p-value is computed
reporting the probability that a z-statistic at least as extreme as the
observed value would be selected at random * If the p-value is small we
reject the null hypothesis and state that there is evidence against the
null (i.e. the gene is differentially expressed).</p>
<p>The <strong>model fit and Wald test were already run previously as part of the
<code>DESeq()</code> function</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="c1">## DO NOT RUN THIS CODE</span>

<span class="c1">## Create DESeq2Dataset object</span>
<span class="n">dds</span> <span class="o">&lt;-</span> <span class="nf">DESeqDataSetFromMatrix</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">colData</span> <span class="o">=</span> <span class="n">meta</span><span class="p">,</span> <span class="n">design</span> <span class="o">=</span> <span class="o">~</span> <span class="n">sampletype</span><span class="p">)</span>

<span class="c1">## Run analysis</span>
<span class="n">dds</span> <span class="o">&lt;-</span> <span class="nf">DESeq</span><span class="p">(</span><span class="n">dds</span><span class="p">)</span>
</code></pre></div>
<h3 id="likelihood-ratio-test-lrt">Likelihood ratio test (LRT)</h3>
<p>An alternative to pair-wise comparisons is to <strong>analyze all levels of a
factor at once</strong>. By default, the Wald test is used to generate the
results table, but DESeq2 also offers the LRT which is used to identify
any genes that show change in expression across the different levels.
This type of test can be especially useful in analyzing time course
experiments.</p>
<p><em>How does this compare to the Wald test?</em></p>
<p>The <strong>Wald test</strong> evaluates whether a gene’s expression is up- or
down-regulated in one group compared to another, while the LRT
<strong>identifies genes that are changing in expression in any combination
across the different sample groups</strong>. For example:</p>
<ul>
<li>Gene expression is equal between Control and Overexpression, but is
    less in Knockdown</li>
<li>Gene expression of Overexpression is lower than Control and Control
    is lower than Knockdown</li>
<li>Gene expression of Knockdown is equal to Control, but less than
    Overexpression.</li>
</ul>
<p>Using LRT, we are evaluating the <strong>null hypothesis that the full model
fits just as well as the reduced model</strong>. If we reject the null
hypothesis, this suggests that there is a significant amount of
variation explained by the full model (and our main factor of interest),
therefore the gene is differentially expressed across the different
levels. Generally, this test will result in a larger number of genes
than the individual pair-wise comparisons. However, while the LRT is a
test of significance for differences of any level of the factor, one
should not expect it to be exactly equal to the union of sets of genes
using Wald tests (although we do expect a majority overlap).</p>
<p>To use the LRT, we use the <code>DESeq()</code> function but this time adding two
arguments:</p>
<ol>
<li>specifying that we want to use the LRT test</li>
<li>the ‘reduced’ model</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="c1"># The full model was specified previously with the `design = ~ sampletype`:</span>
<span class="c1"># dds &lt;- DESeqDataSetFromMatrix(data, colData = meta, ~ sampletype)</span>

<span class="c1"># Likelihood ratio test</span>
<span class="n">dds_lrt</span> <span class="o">&lt;-</span> <span class="nf">DESeq</span><span class="p">(</span><span class="n">dds</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="s">&quot;LRT&quot;</span><span class="p">,</span> <span class="n">reduced</span> <span class="o">=</span> <span class="o">~</span> <span class="m">1</span><span class="p">)</span>
</code></pre></div>
<p>Since our ‘full’ model only has one factor (<code>sampletype</code>), the ‘reduced’
model (removing that factor) is just the intercept (\~ 1). You will find
that similar columns are reported for the LRT test. One thing to note
is, <strong>even though there are fold changes present they are not directly
associated with the actual hypothesis test.</strong></p>
<details>
<summary>
**Time course analyses with LRT**
</summary>

The LRT test can be especially helpful when performing time course
analyses. We can use the LRT to explore whether there are any
significant differences in treatment effect between any of the
timepoints.

For have an experiment looking at the effect of treatment over time on
mice of two different genotypes. We could use a design formula for our
‘full model’ that would include the major sources of variation in our
data: genotype, treatment, time, and our main condition of interest,
which is the difference in the effect of treatment over time
(treatment:time).

<div class="highlight"><pre><span></span><code><span class="n">full_model</span> <span class="o">&lt;-</span> <span class="o">~</span> <span class="n">genotype</span> <span class="o">+</span> <span class="n">treatment</span> <span class="o">+</span> <span class="n">time</span> <span class="o">+</span> <span class="n">treatment</span><span class="o">:</span><span class="n">time</span>
</code></pre></div>

To perform the LRT test, we can determine all genes that have
significant differences in expression between treatments across time
points by giving the ‘reduced model’ without the treatment:time term:

<div class="highlight"><pre><span></span><code><span class="n">reduced_model</span> <span class="o">&lt;-</span> <span class="o">~</span> <span class="n">genotype</span> <span class="o">+</span> <span class="n">treatment</span> <span class="o">+</span> <span class="n">time</span>
</code></pre></div>

Then, we could run our test by using the following code:

<div class="highlight"><pre><span></span><code><span class="n">dds</span> <span class="o">&lt;-</span> <span class="nf">DESeqDataSetFromMatrix</span><span class="p">(</span><span class="n">countData</span> <span class="o">=</span> <span class="n">raw_counts</span><span class="p">,</span> <span class="n">colData</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">design</span> <span class="o">=</span> <span class="o">~</span> <span class="n">genotype</span> <span class="o">+</span> <span class="n">treatment</span> <span class="o">+</span> <span class="n">time</span> <span class="o">+</span> <span class="n">treatment</span><span class="o">:</span><span class="n">time</span><span class="p">)</span>

<span class="n">dds_lrt_time</span> <span class="o">&lt;-</span> <span class="nf">DESeq</span><span class="p">(</span><span class="n">dds</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="s">&quot;LRT&quot;</span><span class="p">,</span> <span class="n">reduced</span> <span class="o">=</span> <span class="o">~</span> <span class="n">genotype</span> <span class="o">+</span> <span class="n">treatment</span> <span class="o">+</span> <span class="n">time</span><span class="p">)</span>
</code></pre></div>

This analysis will not return genes where the treatment effect does not
change over time, even though the genes may be differentially expressed
between groups at a particular time point, as shown in the figure below:

<div class="highlight"><pre><span></span><code><span class="n">knitr</span><span class="o">::</span><span class="nf">include_graphics</span><span class="p">(</span><span class="s">&quot;./img/08c_hypothesis_testing/lrt_time_nodiff.png&quot;</span><span class="p">)</span>
</code></pre></div>

The significant DE genes will represent those genes that have
differences in the effect of treatment over time, an example is
displayed in the figure below:

<div class="highlight"><pre><span></span><code><span class="n">knitr</span><span class="o">::</span><span class="nf">include_graphics</span><span class="p">(</span><span class="s">&quot;./img/08c_hypothesis_testing/lrt_time_yesdiff.png&quot;</span><span class="p">)</span>
</code></pre></div>

</details>

<hr />
<p><strong>Exercise</strong></p>
<p>You are studying brain maturation and growth patterns in mouse cortex
and have obtained RNA-seq data for a total of 31 mice. These samples
were acquired at 9 developmental stages during the postnatal period of
2-40 days of growth, with at least three replicates at each stage. You
also have sex information for these mice (16 males and 15 females).</p>
<ol>
<li>What is an appropriate hypothesis test if you are testing for
    expression differences across the developmental stages?</li>
<li>Provide the line of code used to create the <code>dds</code> object.</li>
<li>Provide the line of code used to run DESeq2.</li>
<li>The results of the differential expression analysis run identifies a
    group of genes that spike in expression between the first and second
    timepoints with no change in expression thereafter. How would we go
    about obtaining fold changes for these genes?</li>
</ol>
<hr />
<h2 id="multiple-test-correction">Multiple test correction</h2>
<p>Regardless of whether we use the Wald test or the LRT, each gene that
has been tested will be associated with a p-value. It is this result
which we use to determine which genes are considered significantly
differentially expressed. However, <strong>we cannot use the p-value
directly.</strong></p>
<h3 id="what-does-the-p-value-mean">What does the p-value mean?</h3>
<p>A gene with a significance cut-off of p \&lt; 0.05, means there is a 5%
chance it is a false positive. For example, if we test 20,000 genes for
differential expression, at p \&lt; 0.05 we would expect to find 1,000 DE
genes by chance. If we found 3000 genes to be differentially expressed
total, roughly one third of our genes are false positives! We would not
want to sift through our “significant” genes to identify which ones are
true positives.</p>
<p>Since each p-value is the result of a single test (single gene). The
more genes we test, the more we inflate the false positive rate. <strong>This
is the multiple testing problem.</strong></p>
<h3 id="correcting-the-p-value-for-multiple-testing">Correcting the p-value for multiple testing</h3>
<p>There are a few common approaches for multiple test correction:</p>
<ul>
<li><strong>Bonferroni:</strong> The adjusted p-value is calculated by: p-value * m
    (m = total number of tests). <strong>This is a very conservative approach
    with a high probability of false negatives</strong>, so is generally not
    recommended.</li>
<li><strong>FDR/Benjamini-Hochberg:</strong> Benjamini and Hochberg (1995) defined
    the concept of False Discovery Rate (FDR) and created an algorithm
    to control the expected FDR below a specified level given a list of
    independent p-values. <a href="https://www.statisticshowto.com/benjamini-hochberg-procedure/">More info about
    BH</a>.</li>
<li><strong>Q-value / Storey method:</strong> The minimum FDR that can be attained
    when calling that feature significant. For example, if gene X has a
    q-value of 0.013 it means that 1.3% of genes that show p-values at
    least as small as gene X are false positives.</li>
</ul>
<p>DESeq2 helps reduce the number of genes tested by removing those genes
unlikely to be significantly DE prior to testing, such as those with low
number of counts and outlier samples (<a href="08c_hypothesis_testing.html#gene-level-filtering">see
below</a>). However,
multiple test correction is also implemented to reduce the False
Discovery Rate using an interpretation of the Benjamini-Hochberg
procedure.</p>
<p><strong>So what does FDR \&lt; 0.05 mean?</strong></p>
<p>By setting the FDR cutoff to \&lt; 0.05, we’re saying that the proportion
of false positives we expect amongst our differentially expressed genes
is 5%. For example, if you call 500 genes as differentially expressed
with an FDR cutoff of 0.05, you expect 25 of them to be false positives.</p>
<h2 id="exploring-results-wald-test">Exploring Results (Wald test)</h2>
<p>By default DESeq2 uses the Wald test to identify genes that are
differentially expressed between two sample groups. Given the factor(s)
used in the design formula, and how many factor levels are present, we
can extract results for a number of different comparisons. Here, we will
walk you through how to obtain results from the <code>dds</code> object and provide
some explanations on how to interpret them.</p>
<blockquote>
<p><strong>NOTE:</strong> The Wald test can also be used with <strong>continuous
variables</strong>. If the variable of interest provided in the design
formula is continuous-valued, then the reported <code>log2FoldChange</code> is
per unit of change of that variable.</p>
</blockquote>
<h3 id="specifying-contrasts">Specifying contrasts</h3>
<p>In our dataset, we have three sample groups so we can make three
possible pairwise comparisons:</p>
<ol>
<li>Control vs. Mov10 overexpression</li>
<li>Control vs. Mov10 knockdown</li>
<li>Mov10 knockdown vs. Mov10 overexpression</li>
</ol>
<p><strong>We are really only interested in #1 and #2 from above</strong>. When we
intially created our <code>dds</code> object we had provided <code>~ sampletype</code> as our
design formula, indicating that <code>sampletype</code> is our main factor of
interest.</p>
<p>To indicate which two sample groups we are interested in comparing, we
need to specify <strong>contrasts</strong>. The contrasts are used as input to the
DESeq2 <code>results()</code> function to extract the desired results.</p>
<p>Contrasts can be specified in two different ways (with the first method
more commonly used):</p>
<ol>
<li>Contrasts can be supplied as a <strong>character vector with exactly three
    elements</strong>: the name of the factor (of interest) in the design
    formula, the name of the two factors levels to compare. The factor
    level given last is the base level for the comparison. The syntax is
    given below:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="c1"># DO NOT RUN!</span>
<span class="n">contrast</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;condition&quot;</span><span class="p">,</span> <span class="s">&quot;level_to_compare&quot;</span><span class="p">,</span> <span class="s">&quot;base_level&quot;</span><span class="p">)</span>
<span class="nf">results</span><span class="p">(</span><span class="n">dds</span><span class="p">,</span> <span class="n">contrast</span> <span class="o">=</span> <span class="n">contrast</span><span class="p">)</span>
</code></pre></div>
<ol>
<li>Contrasts can be given as a <strong>list of 2 character vectors</strong>: the
    names of the fold changes for the level of ineterest, and the names
    of the fold changes for the base level. These names should match
    identically to the elements of <code>resultsNames(object)</code>. <em>This method
    can be useful for combining interaction terms and main effects.</em></li>
</ol>
<div class="highlight"><pre><span></span><code><span class="c1"># DO NOT RUN!</span>
<span class="nf">resultsNames</span><span class="p">(</span><span class="n">dds</span><span class="p">)</span> <span class="c1"># to see what names to use</span>
<span class="n">contrast</span> <span class="o">&lt;-</span> <span class="nf">list</span><span class="p">(</span><span class="nf">resultsNames</span><span class="p">(</span><span class="n">dds</span><span class="p">)[</span><span class="m">1</span><span class="p">],</span> <span class="nf">resultsNames</span><span class="p">(</span><span class="n">dds</span><span class="p">)[</span><span class="m">2</span><span class="p">])</span>
<span class="nf">results</span><span class="p">(</span><span class="n">dds</span><span class="p">,</span> <span class="n">contrast</span> <span class="o">=</span> <span class="n">contrast</span><span class="p">)</span>
</code></pre></div>
<p>Alternatively, if you <strong>only had two factor levels you could do
nothing</strong> and not worry about specifying contrasts
(i.e. <code>results(dds)</code>). In this case, DESeq2 will choose what your base
factor level based on alphabetical order of the levels.</p>
<p>To start, we want to evaluate <strong>expression changes between the MOV10
overexpression samples and the control samples</strong>. As such we will use
the first method for specifcying contrasts and create a character
vector:</p>
<div class="highlight"><pre><span></span><code><span class="c1">## Define contrasts for MOV10 overexpression</span>
<span class="n">contrast_oe</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;sampletype&quot;</span><span class="p">,</span> <span class="s">&quot;MOV10_overexpression&quot;</span><span class="p">,</span> <span class="s">&quot;control&quot;</span><span class="p">)</span>
</code></pre></div>
<blockquote>
<h3 id="does-it-matter-what-i-choose-to-be-my-base-level">Does it matter what I choose to be my base level?</h3>
<p>Yes, it does matter. <strong>Deciding what level is the base level will
determine how to interpret the fold change that is reported.</strong> So for
example, if we observe a log2 fold change of -2 this would mean the
gene expression is lower in factor level of interest relative to the
base level. Thus, if leaving it up to DESeq2 to decide on the
contrasts be sure to check that the alphabetical order coincides with
the fold change direction you are anticipating.</p>
</blockquote>
<h2 id="the-results-table">The results table</h2>
<p>Now that we have our contrast created, we can use it as input to the
<code>results()</code> function. Let’s take a quick look at the help manual for the
function:</p>
<div class="highlight"><pre><span></span><code><span class="o">?</span><span class="n">results</span>
</code></pre></div>
<p>You will see we have the option to provide a wide array of arguments and
tweak things from the defaults as needed. As we go through the lesson we
will keep coming back to the help documentation to discuss some
arguments that are good to know about.</p>
<div class="highlight"><pre><span></span><code><span class="c1">## Extract results for MOV10 overexpression vs control</span>
<span class="n">res_tableOE</span> <span class="o">&lt;-</span> <span class="nf">results</span><span class="p">(</span><span class="n">dds</span><span class="p">,</span> <span class="n">contrast</span><span class="o">=</span><span class="n">contrast_oe</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="m">0.05</span><span class="p">)</span>
</code></pre></div>
<blockquote>
<p><strong>NOTE:</strong> For our analysis, in addition to the <code>contrast</code> argument we
will also provide a value of 0.05 for the <code>alpha</code> argument. We will
describe this in more detail when we talk about gene-level filtering.</p>
</blockquote>
<p>The results table that is returned to us is <strong>a <code>DESeqResults</code> object</strong>,
which is a simple subclass of DataFrame. In many ways it can be treated
like a dataframe (i.e when accessing/subsetting data), however it is
important to recognize that there are differences for downstream steps
like visualization.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Check what type of object is returned</span>
<span class="nf">class</span><span class="p">(</span><span class="n">res_tableOE</span><span class="p">)</span>
</code></pre></div>
<p>Now let’s take a look at <strong>what information is stored</strong> in the results:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># What is stored in results?</span>
<span class="n">res_tableOE</span> <span class="o">%&gt;%</span> 
  <span class="nf">data.frame</span><span class="p">()</span> <span class="o">%&gt;%</span> 
  <span class="nf">View</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>log2 fold change (MAP): sampletype MOV10_overexpression vs control 
Wald test p-value: sampletype MOV10_overexpression vs control 
DataFrame with 57914 rows and 6 columns
baseMean    log2FoldChange  lfcSE       stat        pvalue      padj
&lt;numeric&gt;   &lt;numeric&gt;   &lt;numeric&gt;   &lt;numeric&gt;   &lt;numeric&gt;   &lt;numeric&gt;
ENSG00000000003     3.53E+03    -0.427190489    0.0755347   -5.65604739 1.55E-08    4.47E-07
ENSG00000000005     2.62E+01    0.016159765 0.23735203  0.06584098  9.48E-01    9.74E-01
ENSG00000000419     1.48E+03    0.362663551 0.10761742  3.36995355  7.52E-04    4.91E-03
ENSG00000000457     5.19E+02    0.219135591 0.09768842  2.24476439  2.48E-02    8.21E-02
ENSG00000000460     1.16E+03    -0.261603812    0.07912962  -3.30661411 9.44E-04    5.92E-03
...         ...     ...     ...     ...     ...     ...
</code></pre></div>
<p>We have six columns of information reported for each gene (row). We can
use the <code>mcols()</code> function to extract information on what the values
stored in each column represent:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Get information on each column in results</span>
<span class="nf">mcols</span><span class="p">(</span><span class="n">res_tableOE</span><span class="p">,</span> <span class="n">use.names</span><span class="o">=</span><span class="bp">T</span><span class="p">)</span>
</code></pre></div>
<ul>
<li><code>baseMean</code>: mean of normalized counts for all samples</li>
<li><code>log2FoldChange</code>: log2 fold change</li>
<li><code>lfcSE</code>: standard error</li>
<li><code>stat</code>: Wald statistic</li>
<li><code>pvalue</code>: Wald test p-value</li>
<li><code>padj</code>: BH adjusted p-values</li>
</ul>
<h2 id="p-values">P-values</h2>
<p>The p-value is a probability value used to determine whether there is
evidence to reject the null hypothesis. <strong>A smaller p-value means that
there is stronger evidence in favor of the alternative hypothesis</strong>.</p>
<p><strong>The <code>padj</code> column</strong> in the results table represents the p-value
adjusted for multiple testing, and is the most important column of the
results. Typically, a threshold such as <code>padj</code> \&lt; 0.05 is a good
starting point for identifying significant genes. The default method for
<strong>multiple test correction</strong> in DESeq2 is the FDR. Other methods can be
used with the <code>pAdjustMethod</code> argument in the <code>results()</code> function.</p>
<h3 id="gene-level-filtering">Gene-level filtering</h3>
<p>Let’s take a closer look at our results table. As we scroll through it,
you will notice that for <strong>selected genes there are NA values in the
<code>pvalue</code> and <code>padj</code> columns</strong>. What does this mean?</p>
<p><img src="./img/08c_hypothesis_testing/gene_filtering.png" style="display: block; margin: auto;" /></p>
<p>The missing values represent genes that have undergone filtering as part
of the <code>DESeq()</code> function. Prior to differential expression analysis it
is <strong>beneficial to omit genes that have little or no chance of being
detected as differentially expressed.</strong> This will increase the power to
detect differentially expressed genes. DESeq2 does not physically remove
any genes from the original counts matrix, and so all genes will be
present in your results table. The genes omitted by DESeq2 meet one of
the <strong>three filtering criteria outlined below</strong>:</p>
<p><strong>1. Genes with zero counts in all samples</strong></p>
<p>If within a row, all samples have zero counts there is no expression
information and therefore these genes are not tested.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Filter genes by zero expression</span>
<span class="n">res_tableOE</span><span class="p">[</span><span class="nf">which</span><span class="p">(</span><span class="n">res_tableOE</span><span class="o">$</span><span class="n">baseMean</span> <span class="o">==</span> <span class="m">0</span><span class="p">),]</span> <span class="o">%&gt;%</span> 
  <span class="nf">data.frame</span><span class="p">()</span> <span class="o">%&gt;%</span> 
  <span class="nf">View</span><span class="p">()</span>
</code></pre></div>
<blockquote>
<p><strong>The baseMean column for these genes will be zero, and the log2 fold
change estimates, p-value and adjusted p-value will all be set to
NA.</strong></p>
</blockquote>
<p><strong>2. Genes with an extreme count outlier</strong></p>
<p>The <code>DESeq()</code> function calculates, for every gene and for every sample,
a diagnostic test for outliers called Cook’s distance. Cook’s distance
is a measure of how much a single sample is influencing the fitted
coefficients for a gene, and a large value of Cook’s distance is
intended to indicate an outlier count. Genes which contain a Cook’s
distance above a threshold are flagged, however at least 3 replicates
are required for flagging, as it is difficult to judge which sample
might be an outlier with only 2 replicates. We can turn off this
filtering by using the <code>cooksCutoff</code> argument in the <code>results()</code>
function.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Filter genes that have an extreme outlier</span>
<span class="n">res_tableOE</span><span class="p">[</span><span class="nf">which</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">res_tableOE</span><span class="o">$</span><span class="n">pvalue</span><span class="p">)</span> <span class="o">&amp;</span> 
                    <span class="nf">is.na</span><span class="p">(</span><span class="n">res_tableOE</span><span class="o">$</span><span class="n">padj</span><span class="p">)</span> <span class="o">&amp;</span>
                    <span class="n">res_tableOE</span><span class="o">$</span><span class="n">baseMean</span> <span class="o">&gt;</span> <span class="m">0</span><span class="p">),]</span> <span class="o">%&gt;%</span> 
  <span class="nf">data.frame</span><span class="p">()</span> <span class="o">%&gt;%</span> 
  <span class="nf">View</span><span class="p">()</span>
</code></pre></div>
<blockquote>
<p><strong>If a gene contains a sample with an extreme count outlier then the
p-value and adjusted p-value will be set to NA.</strong></p>
</blockquote>
<p><strong>3. Genes with a low mean normalized counts</strong></p>
<p>DESeq2 defines a low mean threshold, that is empirically determined from
your data, in which the fraction of significant genes can be increased
by reducing the number of genes that are considered for multiple
testing. This is based on the notion that genes with very low counts are
not likely to see significant differences typically due to high
dispersion.</p>
<p><img src="./img/08c_hypothesis_testing/indep_filt_scatterplus.png" style="display: block; margin: auto;" /></p>
<p><em>Image courtesy of <a href="https://www.slideshare.net/joachimjacob/5rna-seqpart5detecting-differentialexpression">slideshare
presentation</a>
from Joachim Jacob, 2014.</em></p>
<p>At a user-specified value (<code>alpha = 0.05</code>), DESeq2 evaluates the change
in the number of significant genes as it filters out increasingly bigger
portions of genes based on their mean counts, as shown in the figure
above. The point at which the number of significant genes reaches a peak
is the low mean threshold that is used to filter genes that undergo
multiple testing. There is also an argument to turn off the filtering
off by setting <code>independentFiltering = F</code>.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Filter genes below the low mean threshold</span>
<span class="n">res_tableOE</span><span class="p">[</span><span class="nf">which</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">res_tableOE</span><span class="o">$</span><span class="n">pvalue</span><span class="p">)</span> <span class="o">&amp;</span> 
                    <span class="nf">is.na</span><span class="p">(</span><span class="n">res_tableOE</span><span class="o">$</span><span class="n">padj</span><span class="p">)</span> <span class="o">&amp;</span> 
                    <span class="n">res_tableOE</span><span class="o">$</span><span class="n">baseMean</span> <span class="o">&gt;</span> <span class="m">0</span><span class="p">),]</span> <span class="o">%&gt;%</span> 
  <span class="nf">data.frame</span><span class="p">()</span> <span class="o">%&gt;%</span> 
  <span class="nf">View</span><span class="p">()</span>
</code></pre></div>
<blockquote>
<p><strong>If a gene is filtered by independent filtering, then only the
adjusted p-value will be set to NA.</strong></p>
<p><em><strong>NOTE:</strong> DESeq2 will perform the filtering outlined above by
default; however other DE tools, such as EdgeR will not. Filtering is
a necessary step, even if you are using limma-voom and/or edgeR’s
quasi-likelihood methods. Be sure to follow pre-filtering steps when
using other tools, as outlined in their user guides found on
Bioconductor as they generally perform much better.</em></p>
</blockquote>
<h2 id="fold-changes">Fold changes</h2>
<p>Another important column in the results table, is the <code>log2FoldChange</code>.
With large significant gene lists it can be hard to extract meaningful
biological relevance. To help increase stringency, one can also <strong>add a
fold change threshold</strong>. Keep in mind when setting that value that we
are working with log2 fold changes, so a cutoff of <code>log2FoldChange</code> \&lt; 1
would translate to an actual fold change of 2.</p>
<blockquote>
<h3 id="an-alternative-approach-to-add-the-fold-change-threshold">An alternative approach to add the fold change threshold:</h3>
<p>The <code>results()</code> function has an option to add a fold change threshold
using the <code>lfcThrehsold</code> argument. This method is more statistically
motivated, and is recommended when you want a more confident set of
genes based on a certain fold-change. It actually performs a
statistical test against the desired threshold, by performing a
two-tailed test for log2 fold changes greater than the absolute value
specified. The user can change the alternative hypothesis using
<code>altHypothesis</code> and perform two one-tailed tests as well. <strong>This is a
more conservative approach, so expect to retrieve a much smaller set
of genes!</strong></p>
</blockquote>
<p>The fold changes reported in the results table are calculated by:</p>
<div class="highlight"><pre><span></span><code><span class="nf">log2 </span><span class="p">(</span><span class="n">normalized_counts_group1</span> <span class="o">/</span> <span class="n">normalized_counts_group2</span><span class="p">)</span>
</code></pre></div>
<h2 id="summarizing-results">Summarizing results</h2>
<p>To summarize the results table, a handy function in DESeq2 is
<code>summary()</code>. Confusingly it has the same name as the function used to
inspect data frames. This function, when called with a DESeq results
table as input, will summarize the results using a default threshold of
padj \&lt; 0.1. However, since we had set the <code>alpha</code> argument to 0.05 when
creating our results table threshold: FDR \&lt; 0.05 (padj/FDR is used even
though the output says <code>p-value &lt; 0.05</code>). Let’s start with the OE vs
control results:</p>
<div class="highlight"><pre><span></span><code><span class="c1">## Summarize results</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">res_tableOE</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="m">0.05</span><span class="p">)</span>
</code></pre></div>
<p>In addition to the number of genes up- and down-regulated at the default
threshold, <strong>the function also reports the number of genes that were
tested (genes with non-zero total read count), and the number of genes
not included in multiple test correction due to a low mean count</strong>.</p>
<h2 id="extracting-significant-differentially-expressed-genes">Extracting significant differentially expressed genes</h2>
<p>Let’s first create variables that contain our threshold criteria. We
will only be using the adjusted p-values in our criteria:</p>
<div class="highlight"><pre><span></span><code><span class="c1">### Set thresholds</span>
<span class="n">padj.cutoff</span> <span class="o">&lt;-</span> <span class="m">0.05</span>
</code></pre></div>
<p>We can easily subset the results table to only include those that are
significant using the <code>filter()</code> function, but first we will convert the
results table into a tibble:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Create a tibble of results</span>
<span class="n">res_tableOE_tb</span> <span class="o">&lt;-</span> <span class="n">res_tableOE</span> <span class="o">%&gt;%</span>
  <span class="nf">data.frame</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="nf">rownames_to_column</span><span class="p">(</span><span class="n">var</span><span class="o">=</span><span class="s">&quot;gene&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span> 
  <span class="nf">as_tibble</span><span class="p">()</span>
</code></pre></div>
<p>Now we can subset that table to only keep the significant genes using
our pre-defined thresholds:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Subset the tibble to keep only significant genes</span>
<span class="n">sigOE</span> <span class="o">&lt;-</span> <span class="n">res_tableOE_tb</span> <span class="o">%&gt;%</span>
  <span class="nf">filter</span><span class="p">(</span><span class="n">padj</span> <span class="o">&lt;</span> <span class="n">padj.cutoff</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># Take a quick look at this tibble</span>
<span class="n">sigOE</span>
</code></pre></div>
<p>Now that we have extracted the significant results, we are ready for
visualization!</p>
<hr />
<p><strong>Excercise</strong></p>
<p><strong>MOV10 Differential Expression Analysis: Control versus Knockdown</strong></p>
<p>Now that we have results for the overexpression results, do the same for
the <strong>Control vs. Knockdown samples</strong>.</p>
<ol>
<li>Create a contrast vector called <code>contrast_kd</code>.</li>
<li>Use contrast vector in the <code>results()</code> to extract a results table
    and store that to a variable called <code>res_tableKD</code>.</li>
<li>Using a p-adjusted threshold of 0.05 (<code>padj.cutoff &lt; 0.05</code>), subset
    <code>res_tableKD</code> to report the number of genes that are up- and
    down-regulated in Mov10_knockdown compared to control.</li>
<li>How many genes are differentially expressed in the Knockdown
    compared to Control? How does this compare to the overexpression
    significant gene list (in terms of numbers)?</li>
</ol>
<hr />
<p><em>This lesson was originally developed by members of the teaching team
(Mary Piper, Meeta Mistry, Radhika Khetani) at the <a href="http://bioinformatics.sph.harvard.edu/">Harvard Chan
Bioinformatics Core (HBC)</a>.</em></p>
<p><em>Some materials and hands-on activities were adapted from <a href="http://www.bioconductor.org/help/workflows/rnaseqGene/#de">RNA-seq
workflow</a> on
the Bioconductor website</em></p>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="08b_DEA.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: DESeq2" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              DESeq2
            </div>
          </div>
        </a>
      
      
        
        <a href="08d_DEA_visualization.html" class="md-footer__link md-footer__link--next" aria-label="Next: Visualization" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Visualization
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": ".", "features": [], "search": "assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="assets/javascripts/bundle.c2e1ee47.min.js"></script>
      
    
  </body>
</html>